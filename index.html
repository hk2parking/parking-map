<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <p>仙台市太白区東郡山2丁目</p>

  <title>太白区 東郡山2丁目 月極駐車場 ｜郡山3丁目 周辺 郡山4丁目 周辺 八本松 周辺</title>
  <meta name="description" content="仙台市太白区東郡山2丁目の月極駐車場（22区画）。料金や空き状況を地図で確認できます。">
  <link rel="canonical" href="https://hk2parking.github.io/parking-map/">
  <meta property="og:title" content="仙台市 太白区 東郡山 2丁目 月極駐車場">
  <meta property="og:description" content="地図で空き区画を確認。防犯カメラ完備、全22区画。">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://hk2parking.github.io/parking-map/">
  <style>
    body { font-family: sans-serif; margin: 12px; }
    #map { width: 100%; height: 640px; border: 1px solid #ccc; }
    h1 { margin-bottom: 8px; }
  </style>
</head>
<body>
  <h1>太白区 東郡山2丁目 月極駐車場</h1>
  <div id="map"></div>

  <script>
  async function initMap() {
    const { Map } = await google.maps.importLibrary("maps");
    const { AdvancedMarkerElement, PinElement } = await google.maps.importLibrary("marker");

    const map = new Map(document.getElementById("map"), {
      center: { lat: 38.221612, lng: 140.900544 },
      zoom: 15,
      mapId: "DEMO_MAP_ID" // 任意
    });

    const infoWindow = new google.maps.InfoWindow();
    const bounds = new google.maps.LatLngBounds();

    const res = await fetch('parkings.csv');
    const text = await res.text();
    const lines = text.trim().split(/\r?\n/);
    const markers = [];

    for (let i = 1; i < lines.length; i++) {
      const cols = lines[i].split(',');
      const name = cols[0]?.trim() || ('NoName-'+i);
      const lat = parseFloat(cols[1]);
      const lng = parseFloat(cols[2]);
      const url = cols[3]?.trim() || '#';
      const status = cols[4]?.trim().toLowerCase();

      if (isNaN(lat) || isNaN(lng)) continue;

      const color = status === 'taken' ? '#d33' : (status === 'free' ? '#28a745' : '#007bff');
      const pin = new PinElement({ background: color, borderColor: "#fff", glyphColor: "#fff" });

      const marker = new AdvancedMarkerElement({
        map,
        position: { lat, lng },
        title: name,
        content: pin.element
      });

      marker.addListener("click", () => {
        infoWindow.setContent(`<strong>${name}</strong><br>` + 
          (url !== '#' ? `<a href="${url}" target="_blank">詳細を見る</a>` : ''));
        infoWindow.open(map, marker);
      });

      markers.push(marker);
      bounds.extend({ lat, lng });
    }

    // ✅ 常に fitBounds（1件でも自動ズーム）
    if (!bounds.isEmpty()) {
      const ne = bounds.getNorthEast();
      const sw = bounds.getSouthWest();

      if (ne.equals(sw)) {
        const delta = 0.0003;
        bounds.extend({ lat: ne.lat() + delta, lng: ne.lng() + delta });
        bounds.extend({ lat: sw.lat() - delta, lng: sw.lng() - delta });
      }
      map.fitBounds(bounds);
    }
  }
  </script>

  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCvMlZ7Q2VqRug6A5k8dCNax7ODFDiBRJc&callback=initMap&loading=async">
  </script>

  <p>仙台市太白区東郡山 2丁目の月極駐車場です。防犯カメラ設置済みで安心。全22区画 空き区画を確認できます。賃料6,600円 申込はGoogleフォームから可能です。</p>
</body>
</html>
