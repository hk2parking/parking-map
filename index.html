<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>太白区 東郡山 2丁目 月極駐車場｜郡山3丁目 周辺 郡山4丁目 周辺 八本松 周辺</title>
<meta name="description" content="仙台市太白区東郡山2丁目の月極駐車場（22区画）。料金や空き状況を地図で確認できます。">
<style>
  body { font-family: sans-serif; margin: 12px; }
  #map { width: 100%; height: 640px; border: 1px solid #ddd; }
  h1 { margin-bottom: 8px; }
</style>
</head>
<body>
<h1>太白区 東郡山2丁目 月極駐車場</h1>
<div id="map"></div>

<script>
async function initMap() {
  const map = new google.maps.Map(document.getElementById('map'), {
    center: { lat: 38.221612, lng: 140.900544 },
    zoom: 15,
    mapTypeId: 'roadmap'
  });

  const infoWindow = new google.maps.InfoWindow();
  const bounds = new google.maps.LatLngBounds();

  try {
    const res = await fetch('parkings.csv');
    if (!res.ok) throw new Error('CSV読み込み失敗: ' + res.status);
    const text = await res.text();
    const lines = text.trim().split('\n');

    for (let i = 1; i < lines.length; i++) {
      if (!lines[i].trim()) continue;
      const cols = lines[i].split(',');
      const name = cols[0]?.trim() || ('NoName-'+i);
      const lat = parseFloat(cols[1]);
      const lng = parseFloat(cols[2]);
      const url = cols[3]?.trim() || '#';
      const status = cols[4]?.trim().toLowerCase();

      if (isNaN(lat) || isNaN(lng)) continue;

      const pinColor = status === 'taken' ? 'red' : (status === 'free' ? 'green' : 'blue');
      const svgMarker = {
        path: "M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z M12 11.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z",
        fillColor: pinColor,
        fillOpacity: 1,
        strokeWeight: 0,
        scale: 1.6
      };

      const marker = new google.maps.Marker({
        position: { lat, lng },
        map,
        title: name,
        icon: svgMarker
      });

      marker.addListener('click', () => {
        infoWindow.setContent(`<strong>${name}</strong><br>` +
                              (url !== '#' ? `<a href="${url}" target="_blank">詳細を見る</a>` : ''));
        infoWindow.open(map, marker);
        map.panTo(marker.getPosition()); // クリック時のみ中心移動
      });

      bounds.extend({ lat, lng });
    }

    // マーカーが1つでも fitBounds でズーム連動
    map.fitBounds(bounds);

    // 必要に応じて最小ズームを設定
    const listener = google.maps.event.addListener(map, "bounds_changed", function() {
      if (map.getZoom() > 17) map.setZoom(17);
      google.maps.event.removeListener(listener);
    });

  } catch (err) {
    console.error(err);
    alert('地図データ読み込みエラー: ' + err.message);
  }
}
</script>

<script async
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-drkY6XN5ki0nZACX8Fdi-UW8nzK5tzs&callback=initMap">
</script>

<p>
仙台市太白区東郡山 2丁目の月極駐車場です。防犯カメラ設置済みで安心。全22区画 空き区画を確認できます。賃料6,600円 申込はGoogleフォームから可能です。
</p>

</body>
</html>
